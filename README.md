# Todos Application

This is a sample Todos application generated by the Payara Starter.

## Getting Started

### Prerequisites

- [Java SE 17+](https://adoptium.net/?variant=openjdk17)
- [Maven](https://maven.apache.org/download.cgi)
- Runtime: Payara 6 with Jakarta EE 10

## Running the Application

### Setup JDBC Connection Pool and Resource

You need to create a JDBC connection pool and resource for the H2 database used by the application.

#### Create the JDBC connection pool:

```bash
asadmin create-jdbc-connection-pool \
 --datasourceclassname=org.h2.jdbcx.JdbcDataSource \
 --restype=javax.sql.DataSource \
 --property user=sa:URL="jdbc\:h2\:file\:~/database/todos\;DB_CLOSE_DELAY\=-1" \      
 myH2Pool
```

Edit the related `domain.xml` file to add an empty password property for the `myH2Pool` connection pool:

```xml
<jdbc-connection-pool datasource-classname="org.h2.jdbcx.JdbcDataSource" name="myH2Pool" res-type="javax.sql.DataSource">
  <property name="user" value="sa"></property>
  <property name="password" value=""></property>
  <property name="URL" value="jdbc:h2:file:~/database/todos;DB_CLOSE_DELAY=-1"></property>
</jdbc-connection-pool>
```

#### Create the JDBC resource:

```bash
asadmin create-jdbc-resource \
 --connectionpoolid=myH2Pool \
 jdbc/myJtaDataSource
```

### Build and Run

1. Open a terminal and navigate to the project's root directory.

2. Make the Maven wrapper executable (only the first time):

```bash
chmod +x mvnw
```

3. Build and start the Payara server with the application:

```bash
./mvnw clean package payara-server:dev
```

Alternatively, you can use the provided `start_server_and_deploy.sh` script (adjust Payara path if needed) to start the server and deploy the application.

### Access the Application

Once the runtime starts, access the REST API at: http://localhost:8080/todos/api/

For example, to list all users: http://localhost:8080/todos/api/users

### Authentication

The application uses JWT-based authentication.

- To login, send a POST request to `/api/auth/login` with JSON body containing `username` and `password`.
- On successful login, you receive a JWT token.
- Include the token in the `Authorization` header as `Bearer <token>` for subsequent requests to protected endpoints.

### Initial Data

The database is pre-populated with users and todo lists. Passwords are bcrypt hashed:

- User `alice` with password `alice`
- User `bob` with password `bob`
- User `carol` with password `carol`
- User `admin` with password `admin`

## About

This project demonstrates a Jakarta EE 10 application running on Payara 6, using H2 database and Flyway for migrations. It provides RESTful endpoints for managing users, todo lists, and tasks.

For more information, visit the [Payara website](https://www.payara.fish/) and the [Payara documentation](https://docs.payara.fish/).
