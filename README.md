# Todos Application

This is a sample Todos application generated by the Payara Starter.

## Getting Started

### Prerequisites

- [Java SE 17+](https://adoptium.net/?variant=openjdk17)
- [Maven](https://maven.apache.org/download.cgi)
- Runtime: Payara 6 with Jakarta EE 10

## Setup JDBC Connection Pool and Resource

You need to create a JDBC connection pool and a JDBC resource for the H2 database used by the application.

The easiest way to do this is to edit the `domain.xml` file located in your Payara installation directory:
`PATH_TO_PAYARA/glassfish/domains/domain1/config/domain.xml`.

Insert the following configuration of pool and resource in the resource part of the domain.xml (e.g., just
before the closing tag `</resource>`).

```xml

<jdbc-connection-pool datasource-classname="org.h2.jdbcx.JdbcDataSource" name="myH2Pool"
                      res-type="javax.sql.DataSource">
    <property name="password" value=""></property>
    <property name="user" value="sa"></property>
    <property name="URL" value="jdbc:h2:file:~/database/todos;DB_CLOSE_DELAY=-1"></property>
</jdbc-connection-pool>
<jdbc-resource pool-name="myH2Pool" jndi-name="jdbc/myJtaDataSource"></jdbc-resource>
```

Note that according to that configuration the location of you database will be in your directory `~/database` and the
H2 database file will be `todos`.

## Setup Database

1. Open a terminal and navigate to the project's root directory.

2. Make the Maven wrapper executable (only the first time):

```bash
chmod +x mvnw
```

3. Execute SQL script(s) to create the database:

```bash
./mvnw flyway:migrate
```

This will create the todos database (file `todos.mv.db`) in your directory `~/database`. If the directory does not
exist, it will be created automatically.

## Start the application

Use the provided `start_server_and_deploy.sh` script (adjust Payara path if needed) to build the project, start the
server and deploy the application.

### Alternative: Payara Micro

The Payara Micro server is a JAR file: `payara-micro-6.2025.6.jar`.

#### Configuration

The file `domain.xml` in `payara-micro-6.2025.6.jar` must be changed in the same way as when using the normal
Payara server (see above).

Inside the `payara-micro-6.2025.6.jar` file its full path is: `/MICRO-INF/domain/domain.xml`.

#### Build the application

```bash
./mvnw clean package
```

After that you will find `todos.war` in the project folder `target`.

#### Start

```bash
java -jar payara-micro-6.2025.6.jar todos.war
```

## Access the Application

Once the runtime starts, access the REST API at: http://localhost:8080/todos/api/

For example, to list all users: http://localhost:8080/todos/api/users

## Authentication

The application uses JWT-based authentication.

- To login, send a POST request to `/api/auth/login` with JSON body containing `username` and `password`.
- On successful login, you receive a JWT token.
- Include the token in the `Authorization` header as `Bearer <token>` for subsequent requests to protected endpoints.

## Initial Data

The database is pre-populated with users and todo lists. Passwords are bcrypt hashed:

- User `admin` with password `admin`
- User `alice` with password `alice`
- User `bob` with password `bob`
- User `carol` with password `carol`

# About

This project demonstrates a Jakarta EE 10 application running on Payara 6, using H2 database and Flyway for migrations.
It provides RESTful endpoints for managing users, todo lists, and tasks.

For more information, visit the [Payara website](https://www.payara.fish/) and
the [Payara documentation](https://docs.payara.fish/).
